<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#050505">
    <title>portrait-mate</title>

    <!-- Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- PhotoSwipe CSS -->
    <link rel="stylesheet" href="/vendor/photoswipe.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Header removed to maximize space -->

    <!-- Main Content Area -->
    <main class="app-main">

        <!-- Photo Gallery (Default Screen) -->
        <section class="screen" id="galleryScreen">
            <div class="screen-content">

                <!-- Empty State -->
                <div class="empty-state" id="emptyState">
                    <div class="empty-icon">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                            <circle cx="12" cy="13" r="4"/>
                        </svg>
                    </div>
                    <h3 class="empty-title">Ready for Photos</h3>
                    <p class="empty-text">Photos will appear here instantly</p>
                </div>

                <!-- Photo Gallery Grid -->
                <div class="photo-gallery" id="photoGallery">
                    <div class="photo-grid" id="photoGrid">
                        <!-- Photos will be added dynamically -->
                    </div>
                </div>

            </div>
        </section>

    </main>

    <!-- Bottom Action Bar -->
    <div class="bottom-action-bar" id="bottomActionBar">
        <div class="connection-warning hidden" id="connectionWarning">
            <span class="warning-dot"></span>
            Reconnecting...
        </div>
        <div class="action-bar-content">
            <button class="btn-action btn-action-secondary" id="resetBtn" type="button">
                Reset
            </button>
            
            <button class="btn-action btn-action-capture" id="captureBtn" type="button" aria-label="Take Photo">
                <div class="shutter-inner"></div>
            </button>

            <button class="btn-action btn-action-primary" id="sendBtn" disabled type="button">
                <span class="btn-text">Send</span>
                <span class="selection-badge" id="selectionBadge">0</span>
            </button>
        </div>
    </div>

    <!-- Phone Number Popup Modal -->
    <div class="modal-overlay" id="phoneModal">
        <div class="modal-container">
            <!-- Phone Input State -->
            <div class="modal-content" id="phoneInputState">
                <h2 class="modal-title">Send Photos</h2>
                <p class="modal-description">Enter recipient's phone number</p>

                <form id="phoneForm" class="modal-form">
                    <div class="form-group">
                        <input
                            type="tel"
                            id="phoneInputModal"
                            class="form-input"
                            placeholder="05X-XXX-XXXX"
                            required
                            autocomplete="tel"
                            inputmode="numeric"
                            autofocus
                        >
                        <div class="input-error" id="phoneErrorModal"></div>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="sendSubmitBtn">Send</button>
                    </div>
                </form>
            </div>

            <!-- Sending State -->
            <div class="modal-content hidden" id="sendingState">
                <div class="loading-spinner"></div>
                <h3 class="modal-title">Sending...</h3>
                <p class="modal-description" id="sendingProgress">0 of 0</p>
            </div>

            <!-- Success State -->
            <div class="modal-content hidden" id="successState">
                <div class="success-icon">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="20 6 9 17 4 12"/>
                    </svg>
                </div>
                <h3 class="modal-title">Sent!</h3>
                <p class="modal-description" id="successMessage"></p>
                <button class="btn btn-primary btn-large" id="closeSuccessBtn">Done</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Dialog -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal-container modal-small">
            <div class="modal-content">
                <h2 class="modal-title">Reset Session?</h2>
                <p class="modal-description">This will clear the current gallery.</p>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="confirmCancelBtn">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmResetBtn">Reset</button>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div class="modal-overlay" id="qrModal">
        <div class="modal-container modal-small">
            <div class="modal-content">
                <h2 class="modal-title">WhatsApp Login</h2>
                <p class="modal-description">Scan with your phone to connect</p>
                
                <div class="qr-container" id="qrContainer">
                    <!-- QR Code will be injected here -->
                    <div class="qr-placeholder"></div>
                </div>

                <p class="qr-status" id="qrStatus">Waiting for QR code...</p>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="qrCancelBtn">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Socket.io Client -->
    <script src="/socket.io/socket.io.js"></script>

    <!-- PhotoSwipe Core (ES Modules) -->
    <script type="module">
        import PhotoSwipeLightbox from '/vendor/photoswipe-lightbox.esm.min.js';
        import PhotoSwipe from '/vendor/photoswipe.esm.min.js';

        // Make available globally for app.js
        window.PhotoSwipeLightbox = PhotoSwipeLightbox;
        window.PhotoSwipe = PhotoSwipe;
    </script>

    <!-- App JavaScript -->
    <script src="/app.js"></script>
</body>
</html>
